{% extends "shop/base.html" %}
{% load static %}
{% load filters %}
{% block content %}
{% block title %} {{ product.name }} {% endblock title %}
 <section class="py-5">
            <div class="container px-4 px-lg-5 my-5">
                <div class="row gx-4 gx-lg-5 align-items-center">
                    <div class="col-md-6"><img class="card-img-top mb-5 mb-md-0" src="{{ product.image.url }}" alt="..." /></div>
                    <div class="col-md-6">
                        <div class="small mb-1"></div>
                        <h1 class="display-5 fw-bolder">{{ product.name }}</h1>
                        <div class="fs-5 mb-5">
                            {% if product.discount > 0 %}
                            <span class="text-decoration-line-through">{{ product.price }} P</span>
                            <span>{{ discount_price }} P</span>
                            {% else %}
                            <span> {{ product.price }} P</span>
                            {% endif %}
                        </div>
                        <p class="lead">{{ product.description }}</p>
                        <div class="d-flex">
                            <input class="form-control text-center me-3" id="inputQuantity" type="num" value="1" style="max-width: 3rem" />
                            <button class="btn btn-outline-dark flex-shrink-0" id="add-button" type="button">
                                <i class="bi-cart-fill me-1"></i>
                                <span id="add-button-text">
                                    В корзину
                                </span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- Related items section-->
        <section class="py-5 bg-light">
            <div class="container px-4 px-lg-5 mt-5">
                <h2 class="fw-bolder mb-4">Похожие продукты</h2>
                <div class="row gx-4 gx-lg-5 row-cols-2 row-cols-md-3 row-cols-xl-4 justify-content-center">
                    {% for rel_product in related_products %}
                        <div class="col mb-5">
                            <div class="card h-100">
                                {% if rel_product.discount > 0 %}
                                <div class="badge bg-dark text-white position-absolute" style="top: 0.5rem; right: 0.5rem">Скидка</div>
                                {% endif %}
                                <!-- Product image-->
                                <img class="card-img-top" style="width: 200px; height: 250px;" src="{{ rel_product.image.url }}" alt="..." />
                                <!-- Product details-->
                                <div class="card-body p-4">
                                    <div class="text-center">
                                        <!-- Product name-->
                                        <h5 class="fw-bolder">{{ rel_product.name }}</h5>
                                        <!-- Product price-->

                                        {% if rel_product.discount > 0 %}
                                        <span class="text-muted text-decoration-line-through">{{ rel_product.price }}</span>
                                        {{ rel_product.get_discount_price }}
                                        {% else %}
                                        {{ rel_product.price }} P
                                        {% endif %}
                                    </div>
                                </div>
                                <!-- Product actions-->
                                <div class="card-footer p-4 pt-0 border-top-0 bg-transparent">
                                    <div class="text-center"><a class="btn btn-outline-dark mt-auto" href="/product/{{ rel_product.id }}">Купить</a></div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}

{#                    <div class="col mb-5">#}
{#                        <div class="card h-100">#}
{#                            <!-- Sale badge-->#}
{#                            <div class="badge bg-dark text-white position-absolute" style="top: 0.5rem; right: 0.5rem">Sale</div>#}
{#                            <!-- Product image-->#}
{#                            <img class="card-img-top" src="https://dummyimage.com/450x300/dee2e6/6c757d.jpg" alt="..." />#}
{#                            <!-- Product details-->#}
{#                            <div class="card-body p-4">#}
{#                                <div class="text-center">#}
{#                                    <!-- Product name-->#}
{#                                    <h5 class="fw-bolder">Special Item</h5>#}
{#                                    <!-- Product reviews-->#}
{#                                    <div class="d-flex justify-content-center small text-warning mb-2">#}
{#                                        <div class="bi-star-fill"></div>#}
{#                                        <div class="bi-star-fill"></div>#}
{#                                        <div class="bi-star-fill"></div>#}
{#                                        <div class="bi-star-fill"></div>#}
{#                                        <div class="bi-star-fill"></div>#}
{#                                    </div>#}
{#                                    <!-- Product price-->#}
{#                                    <span class="text-muted text-decoration-line-through">$20.00</span>#}
{#                                    $18.00#}
{#                                </div>#}
{#                            </div>#}
{#                            <!-- Product actions-->#}
{#                            <div class="card-footer p-4 pt-0 border-top-0 bg-transparent">#}
{#                                <div class="text-center"><a class="btn btn-outline-dark mt-auto" href="#">Add to cart</a></div>#}
{#                            </div>#}
{#                        </div>#}
{#                    </div>#}
{#                    <div class="col mb-5">#}
{#                        <div class="card h-100">#}
{#                            <!-- Sale badge-->#}
{#                            <div class="badge bg-dark text-white position-absolute" style="top: 0.5rem; right: 0.5rem">Sale</div>#}
{#                            <!-- Product image-->#}
{#                            <img class="card-img-top" src="https://dummyimage.com/450x300/dee2e6/6c757d.jpg" alt="..." />#}
{#                            <!-- Product details-->#}
{#                            <div class="card-body p-4">#}
{#                                <div class="text-center">#}
{#                                    <!-- Product name-->#}
{#                                    <h5 class="fw-bolder">Sale Item</h5>#}
{#                                    <!-- Product price-->#}
{#                                    <span class="text-muted text-decoration-line-through">$50.00</span>#}
{#                                    $25.00#}
{#                                </div>#}
{#                            </div>#}
{#                            <!-- Product actions-->#}
{#                            <div class="card-footer p-4 pt-0 border-top-0 bg-transparent">#}
{#                                <div class="text-center"><a class="btn btn-outline-dark mt-auto" href="#">Add to cart</a></div>#}
{#                            </div>#}
{#                        </div>#}
{#                    </div>#}
{#                    <div class="col mb-5">#}
{#                        <div class="card h-100">#}
{#                            <!-- Product image-->#}
{#                            <img class="card-img-top" src="https://dummyimage.com/450x300/dee2e6/6c757d.jpg" alt="..." />#}
{#                            <!-- Product details-->#}
{#                            <div class="card-body p-4">#}
{#                                <div class="text-center">#}
{#                                    <!-- Product name-->#}
{#                                    <h5 class="fw-bolder">Popular Item</h5>#}
{#                                    <!-- Product reviews-->#}
{#                                    <div class="d-flex justify-content-center small text-warning mb-2">#}
{#                                        <div class="bi-star-fill"></div>#}
{#                                        <div class="bi-star-fill"></div>#}
{#                                        <div class="bi-star-fill"></div>#}
{#                                        <div class="bi-star-fill"></div>#}
{#                                        <div class="bi-star-fill"></div>#}
{#                                    </div>#}
{#                                    <!-- Product price-->#}
{#                                    $40.00#}
{#                                </div>#}
{#                            </div>#}
{#                            <!-- Product actions-->#}
{#                            <div class="card-footer p-4 pt-0 border-top-0 bg-transparent">#}
{#                                <div class="text-center"><a class="btn btn-outline-dark mt-auto" href="#">Add to cart</a></div>#}
{#                            </div>#}
{#                        </div>#}
{#                    </div>#}
{#                </div>#}
{#            </div>#}
        </section>

<script>
    $(document).on('click', '#add-button', function (e) {
        e.preventDefault();

        let qty = $('#inputQuantity').val();

        $.ajax({
            type: 'POST',
            url: '/cart/add',
            data: {
                product_id: '{{ product.id }}',
                product_qty: qty,
                csrfmiddlewaretoken: '{{ csrf_token }}',
                action: 'post'
            },
            success: function (response) {
                console.log(response)
                {#document.getElementById('').textContent = response.product_qty#}
                document.getElementById('label-cart-count').textContent = response.qty
                {#const add_button = document.getElementById('add-button')#}
                {#add_button.disabled = true#}
                if (qty > 0)
                    document.getElementById('add-button-text').innerText = 'В корзине'
                else {
                    document.getElementById('add-button-text').innerText = 'В корзину'
                    $('#inputQuantity').val(1)
                }

                {#add_button.className = "btn btn-success btn-sm"#}

            },
            error: function (error) {
                console.log(error)
            }
        })

    })
</script>

{% endblock content %}